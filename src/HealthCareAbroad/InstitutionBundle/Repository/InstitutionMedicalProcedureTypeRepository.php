<?php

namespace HealthCareAbroad\InstitutionBundle\Repository;

use Doctrine\ORM\EntityRepository;



/**
 * InstitutionMedicalProcedureTypeRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class InstitutionMedicalProcedureTypeRepository extends EntityRepository
{
	
	function getByInstitutionIdAndMedicalCenterId($institutionId, $medicalCenterId, $status = null)
	{			
		$qb = $this->_em->createQueryBuilder()
			->select('a')
			->from('InstitutionBundle:InstitutionMedicalProcedureType', 'a')
			->innerJoin('a.medicalProcedureType', 'b')
			->add('where','a.institution = :institution')
			->andWhere('b.medicalCenter = :medicalCenter')
			->setParameter('institution', $institutionId)
			->setParameter('medicalCenter', $medicalCenterId)->orderBy('b.name', 'ASC');

		if(!is_null($status)) {
			$qb->andWhere('a.status = :status')->setParameter('status', $status);
		}

		return $qb->getQuery()->getResult();			
	}
}