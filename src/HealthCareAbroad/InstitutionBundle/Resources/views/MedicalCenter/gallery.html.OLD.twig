{% extends 'InstitutionBundle::layout.html.twig' %}
{% set selectedTab = 'medical_centers'%}
{% block title %}{{ parent() }} Add Medical Center Media {% endblock %}


{% block content %}
<!-- start content -->
<div id="content">
    <!--  start page-heading -->
    <div id="page-heading">
        <h1>Add media for {{ institutionMedicalCenter.medicalCenter.name }} medical center</h1>
    </div>
    <!-- end page-heading -->
    
    {% embed '::contentWrapper.admin.html.twig' %}
        
        {% block wrappedContent %}
            
            {# ----- Related tasks ----- #}
            {% include 'InstitutionBundle:MedicalCenter:relatedTasks.html.twig' with {hideAddMedicalCenter: true, hideMedicalProcedureTypeTask: true, 'imcId': institutionMedicalCenter.id } %}
            {# ----- end Related tasks ----- #}
            
            <!--  start table-content  -->
            <div id="table-content">
                <div style="width:75%;">
                    {% include '::notice.admin.html.twig' %}
                    
                    {% include '::stepHolder.base.admin.html.twig' with {
                        steps: [
                            {title: 'Center Details', 'selected': true},
                            {title: 'Add Media', 'selected': true},
                            {title: 'Add Procedure Types'},
                            {title: 'Preview', 'selected': false},
                        ] }
                  %}                
                
                    <div id="tabs">
                    
                        <ul style="height: 33px">
                            <li><a href="#tab1">From Computer</a></li>
                            <li><a href="#tab2">Media Gallery</a></li>
                        </ul>
                        
                        <div id="tab1">
                            <h3>Upload media files from your computer</h3>
                            <div id="dialog-form" title="Add media">
                                <form>
                                    <div id="uploader">
                                        <p>You browser doesn't have Flash, Silverlight, Gears, BrowserPlus or HTML5 support.</p>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <!-- TODO: load this tab via ajax -->
                        <div id="tab2">
                            <h3>Attach media files from gallery</h3>
                            
                            <table border="0" width="100%" cellpadding="0" cellspacing="0" class="generic-table">
                                <thead>
                                    <tr>
                                        <th style="width: 90px"></th>
                                        <th class="table-header-repeat line-left minwidth-1"><a href="#">File</a></th>
                                        <th class="table-header-repeat line-left minwidth-1"><a href="#">Attached to</a></th>
                                        <th class="table-header-options line-left"><a href="#">Date</a></th>
                                    </tr>
                                </thead>

                                <tfoot>
                                    <tr>
                                        <td colspan="4">
                                            <div style="float: right">
                                                <a href="#"><img src="/images/admin/table/paging_far_left.gif" ></a>
                                                <a href="#"><img src="/images/admin/table/paging_left.gif" ></a>
                                                <a href="#"><img src="/images/admin/table/paging_right.gif" ></a>
                                                <a href="#"><img src="/images/admin/table/paging_far_right.gif" ></a>							
                                            </div>																		    			                								
                                        </td>
                                    </tr>
                                </tfoot>
                               
                                {% for media in institutionMedia %}
                                    <tr class="{{ cycle(['alternate-row', ''], loop.index) }}">
                                        <td valign="top">{{ media(media, 'galleryAdd', {'institutionId': institutionId}) | raw }}</td>
                                        <td>{{ media.caption }}</td>
                                        <td><div style="font-style: italic;">[Unattached]</div><a href="#"><br/>Attach</a></td>
                                        <td></td>
                                    </tr>
                                {% else %}
                                    <tr>
                                        <td colspan="4" align="center"> {{ app.session.get('institutionName') }} has no media yet. </td>
                                    </tr>    
                                {% endfor %}       
                                
                            </table>                            
                            
                        </div>
                        
                    </div>
                </div>
            
            </div>
            <!--  end table-content  -->
                    
        {% endblock %}
        
    {% endembed %}
    
</div>

<!--  end content -->
<div class="clear">&nbsp;</div>

    {% block inlineJavascriptCode %}
        <!-- Load Queue widget CSS and jQuery -->
        <style type="text/css">@import url({{ asset('bundles/media/js/plupload/js/jquery.ui.plupload/css/jquery.ui.plupload.css') }});</style>

        <!-- Third party script for BrowserPlus runtime (Google Gears included in Gears runtime now) -->
        <script type="text/javascript" src="http://bp.yahooapis.com/2.4.21/browserplus-min.js"></script>

        <!-- Load plupload and all it's runtimes and finally the jQuery UI queue widget -->

        <script type="text/javascript" src="{{ asset('bundles/media/js/plupload/js/plupload.full.js') }}"></script>
        <script type="text/javascript" src="{{ asset('bundles/media/js/plupload/js/jquery.ui.plupload/jquery.ui.plupload.js') }}"></script>
    
        <script type="text/javascript">
        $(function() {
            
            $("#uploader").plupload({
                // General settings
                /*runtimes : 'gears,flash,silverlight,browserplus,html5',*/
                runtimes : 'html5',
                url : '{{ path('media_upload') }}',
                max_file_size : '10mb',
                /*chunk_size : '1mb',*/
                unique_names : true,

                // Resize images on clientside if we can
                //resize : {width : 320, height : 240, quality : 90},

                // Specify what files to browse for
                filters : [
                    {title : "Image files", extensions : "jpg,gif,png"},
                    {title : "Zip files", extensions : "zip"},
                    {title : "Pdf files", extensions : "pdf"},
                    {title : "Video files", extensions : "avi,mov,flv"}
                ],

                // Flash settings
                flash_swf_url : '/plupload/js/plupload.flash.swf',
                //http://www.youtube.com/watch?v=kPIM6V9eeRE
                // Silverlight settings
                //silverlight_xap_url : '/plupload/js/plupload.silverlight.xap'
            });

            // Client side form validation
            $('form').submit(function(e) {
                var uploader = $('#uploader').plupload('getUploader');

                // Files in queue upload them first
                if (uploader.files.length > 0) {
                    // When all files are uploaded submit form
                    uploader.bind('StateChanged', function() {
                        if (uploader.files.length === (uploader.total.uploaded + uploader.total.failed)) {
                            $('form')[0].submit();
                        }
                    });
                        
                    uploader.start();
                } else
                    alert('You must at least upload one file.');

                return false;
            });

            $("#tabs").tabs({
                ajaxOptions: {
                    error: function( xhr, status, index, anchor ) {
                        $( anchor.hash ).html("Couldn't load this tab. We'll try to fix this as soon as possible.");
                    }
                }
            });
            
        });

    </script>
    {% endblock %}

{% endblock %}