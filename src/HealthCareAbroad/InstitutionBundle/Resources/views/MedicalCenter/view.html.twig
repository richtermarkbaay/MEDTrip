{% extends 'InstitutionBundle::layout.html.twig' %}
{% set mainNavigation = {selected: 'clinics' , label : institution.name , url: path('institution_account_profile') } %}
{% set subNavigation = {selected: 'clinics' , label : institutionMedicalCenter.name } %}
{% set _csrf_token_widget = form_widget(institutionMedicalCenterForm._token) %}
{% set clinicClassLabel = getClassLabel('clinic') %}
{% block content %}
    {% include 'InstitutionBundle:MedicalCenter/Widgets:modal.institutionMedicalCenterName.html.twig' %}
    {% embed 'InstitutionBundle:Embed:contentWrapper.authenticated.html.twig' %}
        {% block wrappedContent %}
            <div id="back-top">
                <div class="backtotop img-rounded">
                    <a href="#top"><span><i class="icon-chevron-up"></i></span>Top</a>
                </div>
            </div>
            <div class="tab-content span8">
                {% include 'InstitutionBundle:MedicalCenter/Widgets:profileHeader.html.twig' %}
                <div class="tabbable">
                    {% include 'InstitutionBundle:Widgets:tabNavigation.html.twig' with {
                        tabNavigation: { links: [
                            { label: 'Clinic Details', 'active': true, 'href' : '#profile_tab', 'icon' : 'medkit' },
                            { label: 'Specializations', 'href' : '#specializations_tab_content', 'icon' : 'beaker'},
                            { label: 'Doctors', 'href' : '#doctors_tab_content', 'icon' : 'user-md' },
                        ]}
                    } %}
                    
                    <div class="tab-content" id="tabbed_content">
                        <div id="profile_tab" class="tab-pane active">
                            {% include 'InstitutionBundle:MedicalCenter/Widgets:medicalCenterProfileTabForm.html.twig' %}
                        </div>
                        <div id="specializations_tab_content" class="tab-pane">
                           {% include 'InstitutionBundle:Widgets:tabbedContent.institutionMedicalCenterSpecializations.html.twig' %}
                        </div>
                        <div id="doctors_tab_content" class="tab-pane">                       
                            {% embed 'InstitutionBundle:Widgets:tabbedContent.base.html.twig' %}
                                {% block tabbedContent %}
                                     <section class="doctors-listing">
                                        <h3> Your Doctors
                                            <a id="addDoctorButton" href="#add-doctor" class="btn btn-primary pull-right" data-toggle="modal">Add New Doctor</a>
                                        </h3>
                                        {% include 'InstitutionBundle:MedicalCenter/Widgets:doctorsList.html.twig' %}
                                    </section>
                                {% endblock %}
                            {% endembed %}                                    
                        </div>
                   </div><!-- /.tab-content -->
                </div>
            </div><!-- end .span9 -->
                        
            {% embed 'InstitutionBundle:Embed:wrapper.sidebar.html.twig' %}
                {% block sidebarWrappedContent %}
                 {% include 'InstitutionBundle:MedicalCenter/Widgets:sidebar.institutionMedicalCenter.html.twig' %}
                {% endblock %}
            {% endembed %}
                                                
        {% endblock %}
    {% endembed %}
    
{% endblock %}


{% block inlineJavascriptCode %}
<script type="text/javascript" src="{{ asset('bundles/institution/js/institutionMedicalCenter.js') }}" ></script>
<script type="text/javascript" src="{{ asset('bundles/institution/js/common.js') }}" ></script>
<script type="text/javascript" src="{{ asset('bundles/institution/js/properties.js') }}" ></script>
<script type="text/javascript" src="{{ asset('bundles/helper/js/fancy_business_hours.js') }}" ></script>
<script type="text/javascript" src="{{ asset('js/bootstrap-timepicker.min.js') }}"></script>
<script src="{{ asset('bundles/institution/js/institutionTreatments.js') }}" type="text/javascript"></script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="{{ asset('bundles/helper/js/HCAGoogleMap.js') }}"></script>
<script type="text/javascript">
    function toggle(button) {
        // Change the button caption
        button.innerHTML = button.innerHTML == 'Edit' ? 'x' : 'Edit';
        // Change the parent div's CSS class
        var div = button.parentNode;
        div.className = div.className == 'hca-display' ? 'hca-edit' : 'hca-display';
    }

    Location.loadCitiesUrl = '{{ path("helper_loadCities") }}';
    
    var countryElem = $("#{{ institutionMedicalCenterForm.getChild('country').vars.id }}");
    var coordinatesElem = $("#{{ institutionMedicalCenterForm.getChild('coordinates').vars.id }}");
    var streetAddressElem = $("#{{ institutionMedicalCenterForm.getChild('address').vars.id }}_street");
    var buildingAddressElem = $("#{{ institutionMedicalCenterForm.getChild('address').vars.id }}_building");
    var cityElem = $("#{{ institutionMedicalCenterForm.getChild('city').vars.id }}");
    var countryInputElem = $("#{{ institutionMedicalCenterForm.getChild('country').vars.id }}");
    (function($){
        $(function(){

            // display businesshours
            InstitutionMedicalCenter.displayBusinessHoursView();
            
            HCAGoogleMap.initialize({
                latLngString: '{{ institutionMedicalCenter.coordinates }}',
                address: "{{ medical_center_complete_address_to_array(institutionMedicalCenter, ['address','city','country']) |join(',')}}",
                defaultAddress: cityElem.val() + ',' + countryElem.val(),
                mapOnChangeCallback: function() {
                    coordinatesElem.val(HCAGoogleMap.latLngString);
                }
            });
            
            var ajaxFormUploadElem;
            $('form.ajaxUploadLogoForm').ajaxForm({
               success: function(response) {
                   if(response.status) {
                       ajaxFormUploadElem.find('img').attr('src',response.mediaSrc).css('opacity', 1).prev().show();
                   } else {
                       alert('ERROR: Unable to upload Logo!');
                   }
               },
               complete: function(xhr) {

               }
           }).submit(function(){
               ajaxFormUploadElem = $(this);
               $(this).find('img').css('opacity', 0.5).prev().hide();
           });


            InstitutionMedicalCenter.isEditView = true;

            $('#clinicDescriptionText').truncateByHeight({
                'visibleRows': 5
            });
        });

    })(jQuery);

    function getAddress() {
        var address = ''; 
        if(buildingAddressElem.val() != '') { address += buildingAddressElem.val() + ', '; }
        if(streetAddressElem.val() != '') { address += streetAddressElem.val() + ', '; }
        if(cityElem.val() != '') { address += $("#{{ institutionMedicalCenterForm.getChild('city').vars.id }}").val() + ', '; }
        if(countryElem.val() != '') { address += countryInputElem.val(); }
        
        return address;
    }
    
    function updateInstitutionStaticMap() {
        HCAGoogleMap.updateMap(getAddress());
    }

    $(document).ready(function() {
    	if($('._alert-phone').length >= 1){
    	   $("#view-contacts").find('#alertDiv').addClass('alert alert-block');
       }
        if($('._googleplus-wrapper').html() == 'no account added' ||  $('._twitter-wrapper').html() == 'no account added' || $('._facebook-wrapper').html() == 'no account added'){
    		$('#view-socialMediaSites ').attr('class', 'alert alert-block');
       	}else{
       		$('#view-socialMediaSites ').attr('class', '');
       	}
    });
</script>
{% endblock %}
