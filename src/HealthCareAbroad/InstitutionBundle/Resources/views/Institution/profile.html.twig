{% extends 'InstitutionBundle::layout.html.twig' %}
{% set mainNavigation = {selected: 'manage profile'} %}

{% set _csrf_token_widget = form_widget(institutionForm._token) %}
{% set globalAwardClassLabel = getClassLabel('global_award') %}
{% set ancillaryServiceClassLabel = getClassLabel('ancilliary_service') %}
{% block content %}
    {% include 'InstitutionBundle:Widgets:modal.institutionName.html.twig' %}   
    {% embed 'InstitutionBundle:Embed:contentWrapper.authenticated.html.twig' %}
    
        {% block wrappedContent %}
             <div id="back-top">
                <div class="backtotop img-rounded">
                    <a href="#top"><span><i class="icon-chevron-up"></i></span>Top</a>
                </div>
            </div>
            <!-- Main Content -->    
            {% include 'InstitutionBundle:Widgets:institution_banner.html.twig' %}       
            {% if (isSingleCenter is defined) and isSingleCenter %}
                {% include 'InstitutionBundle:Institution:profile.singleCenter.html.twig' %}
            {% else %}
                {% include 'InstitutionBundle:Institution:profile.multipleCenter.html.twig' %}
            {% endif %}

            <!-- Sidebar Content -->
            {% include 'InstitutionBundle:Widgets:sidebar.base.html.twig' %}
            <!-- end Modal Institution name -->
        {% endblock %}
        
    {% endembed %}

{% endblock %}


{% block inlineJavascriptCode %}
<script type="text/javascript" src="{{ asset('bundles/helper/js/Location.js') }}"></script>
<script type="text/javascript" src="{{ asset('bundles/institution/js/institutionProfile.js') }}"></script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="{{ asset('bundles/helper/js/HCAGoogleMap.js') }}"></script>
<script type="text/javascript">
<!--
    Location.loadCitiesUrl = '{{ path("helper_loadCities") }}';

    var emailElem = $("#{{ institutionForm.getChild('contactEmail').vars.id }}");
    var countryElem = $("#{{ institutionForm.getChild('country').vars.id }}");
    var coordinatesElem = $("#{{ institutionForm.getChild('coordinates').vars.id }}");
    var streetAddressElem = $("#{{ institutionForm.getChild('address1').vars.id }}_street");
    var buildingAddressElem = $("#{{ institutionForm.getChild('address1').vars.id }}_building");
    var cityElem = $("#{{ institutionForm.getChild('city').vars.id }}");
    var countryInputElem = $("#input-{{ institutionForm.getChild('country').vars.id }}");

    (function($){
        $(function(){

            var ajaxFormUploadElem;
            $('form.ajaxUploadLogoForm').ajaxForm({
                success: function(response) {
                   if(response.status) {
                       ajaxFormUploadElem.find('img').attr('src',response.mediaSrc).css('opacity', 1).prev().show();
                   } else {
                       alert('ERROR: Unable to upload Logo!');
                   }
               }
            }).submit(function(){
               ajaxFormUploadElem = $(this);
               $(this).find('img').css('opacity', 0.5).prev().hide();
            });

            $("#{{ institutionForm.getChild('medicalProviderGroups').vars.id }}_0").autocomplete({
                appendTo: "#autoDiv",
                source: $.parseJSON('{{ medicalProvidersJSON | raw}}'),
            });

            var city = "{{ institution.city ? institution.city.name ~ ', ' : '' }}";
            HCAGoogleMap.initialize({
                latLngString: '{{ institution.coordinates }}',
                address: "{{ institution_address_to_array(institution)|join(',') }}",
                defaultAddress: city + "{{ institution.country.name }}",
                mapOnChangeCallback: function() {
                    coordinatesElem.val(HCAGoogleMap.latLngString);
                }
            });
        });
    })(jQuery);
    
    
    function getAddress() {
        var address = ''; 
        if(buildingAddressElem.val() != '') { address += buildingAddressElem.val() + ', '; }
        if(streetAddressElem.val() != '') { address += streetAddressElem.val() + ', '; }
        if(cityElem.val() != '') { address += $("#input-{{ institutionForm.getChild('city').vars.id }}").val() + ', '; }
        if(countryElem.val() != '') { address += countryInputElem.val(); }
        
        return address;
    }
    
    function updateInstitutionStaticMap() {
        HCAGoogleMap.updateMap(getAddress());
    }

	   $(document).ready(function() {
           if($('._alert-phone').length >= 1){
        	   $("#show-contact").find('#alertDiv').attr('class','alert-block');
           }
           if($('._googleplus-wrapper').html() == 'no account added' ||  $('._twitter-wrapper').html() == 'no account added' || $('._facebook-wrapper').html() == 'no account added'){
        		$('#institution-socialMediaSites ').attr('class', 'alert alert-block');
           	}else{
           		$('#institution-socialMediaSites ').attr('class', '');
           	}
       });

</script>
{% endblock %}