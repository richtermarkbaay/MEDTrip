{% embed 'InstitutionBundle:Embed:modalBox.base.html.twig' with {'modal': {'id' : 'add-media', class: 'hca-file-modal', 'title': 'Add New Media' }} %}
    {% block modalBody %}            

    <div class="tabbable">
        <ul class="nav nav-tabs">
            <li class="active"><a href="#pane1" data-toggle="tab"><i class="icon-upload"></i>Upload Photo</a></li>
           <!--<li><a href="#pane2" data-toggle="tab"><i class="icon-facetime-video"></i>Add Video</a></li> -->
        </ul>
        <div class="tab-content">
            <div id="pane1" class="tab-pane active">
                <!-- form id="custom-dropzone" class="dropzone" action="{{ path('institution_mediaGallery_upload') }}">
                    <div class="dropzone-controls">
                        <label>Drag Photo or if you prefer...</label>
                        <span class="btn btn-primary" onclick="$('#custom-dropzone').click()">
                            Select Photo from your Computer
                        </span>
                    </div>
                </form -->
                
                <div id="custom-dropzone" class="dropzone">
                    <div id="previews" class="dropzone-previews"></div>
                    <input name="file" type="file" accept="image/*" style="visibility:hidden"/>
                    <div class="dropzone-controls">
                        <label>Drag Photo or if you prefer...</label>
                        <span class="btn btn-primary" id="clickable">
                            Select Photo from your Computer
                        </span>
                    </div>
                </div>
                
                <form id="addInstitutionMediaForm" action="{{ path('institution_mediaGallery_linkFileToClinics') }}" enctype="multipart/form-data" method="post">
                    <input type="hidden" name="media_ids" id="mediaIds">
                    <p><small>Maximum upload file size:</small>2MB</p>

                    {% include 'InstitutionBundle:MediaGallery/Widgets:medicalCenterList.html.twig' with {selectedClinics: []} %}

                    <div class="align-right action-buttons">
                        <button class="btn cancel" onclick="$('#add-media').modal('hide')" type="button">Cancel</button> &nbsp;
                        <button class="btn btn-primary save" type="submit" disabled="disabled"><i class="icon-save"></i>Save Changes</button> &nbsp;
                        <button class="btn btn-success done" onclick="$('#add-media').modal('hide');" disabled="disabled" type="button">Done</button>
                    </div>
                </form>
            </div>
            {#
            <div id="pane2" class="tab-pane">
                <h4>Link Video</h4>
                <div class="alert alert-info">
                    <div class="media">
                        <i class="icon-facetime-video icon-4x pull-left"></i>
                        <div class="media-body">
                            <h4 class="media-heading">Rules in Linking Videos (Youtube and Vimeo)</h4>
                            <ul>
                                <li>Make sure the video is set to public</li>
                                <li>Click the SHARE TAB under the video</li>
                                <li>Copy the URL and paste it into the form below.</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <form action="#">
                    <div class="row-fluid control-group">
                        <label for="video-title">Enter Video url</label>
                        <input type="text" class="span10"><br/>
                        <small>
                            Example:<br/>
                            <p><b>For Youtube:</b>http://www.youtube.com/watch?v=YE7VzlLtp4isYE7VzlLtp-4
                            <br/>
                            <b>For Vimeo:</b>http://www.youtube.com/watch?v=YE7VzlLtp-4isYE7VzlLtp-
                            </p>
                        </small>
                    </div>
                </form>
            </div>
            #}
        </div>
    </div>

    {% endblock %}
{% endembed %}

{% block inlineJavascriptCode %}
<script type="text/javascript" src="/js/dropzone.js" ></script>

<script type="text/javascript">
    $(function(){
    
    	Dropzone.autoDiscover = false;
    	var addMediaFormElem = $('#addInstitutionMediaForm');
    
        $("#custom-dropzone").dropzone({
            url: "{{ path('institution_mediaGallery_upload') }}",
            method: "post",
            clickable: "#clickable",
            previewsContainer: "#previews",
            
            sending: function(file) {
                addMediaFormElem.find('.action-buttons > button').attr('disabled', 'disabled');
            },

            success: function(file, response) {
                if(response.status) {
                	$(file.previewTemplate).addClass('success');
                	$('#mediaIds').val($('#mediaIds').val() == '' ? response.mediaId : $('#mediaIds').val() + ',' + response.mediaId);
                	addMediaFormElem.find('.medical-center-checkbox:first').change();
                	addMediaFormElem.find('.action-buttons > button.cancel').remove();
                	addMediaFormElem.find('.action-buttons > button.done').removeAttr('disabled');
                } else {
                	$(file.previewTemplate).addClass('error');
                }
            }
        });

        addMediaFormElem.find('.medical-center-checkbox').change(function() {
            
            if($('#mediaIds').val() != '' && addMediaFormElem.find('.medical-center-checkbox:checked').length) {
            	addMediaFormElem.find('.action-buttons > button').removeAttr('disabled');
            } else {
            	addMediaFormElem.find('.action-buttons > button.save').attr('disabled', 'disabled');
            }
        });
    });
</script>
{% endblock %}