{% embed 'InstitutionBundle:Embed:modalBox.base.html.twig' with {'modal': {'id' : 'add-media', class: 'hca-file-modal', 'title': 'Add New Media' }} %}
    {% block modalBody %}            

    <div class="tabbable">
        <ul class="nav nav-tabs">
            <li class="active"><a href="#pane1" data-toggle="tab"><i class="icon-upload"></i>Upload Photo</a></li>
           <!--<li><a href="#pane2" data-toggle="tab"><i class="icon-facetime-video"></i>Add Video</a></li> -->
        </ul>
        <div class="tab-content">
            <div id="pane1" class="tab-pane active">
                <!-- form id="custom-dropzone" class="dropzone" action="{{ path('institution_mediaGallery_upload') }}">
                    <div class="dropzone-controls">
                        <label>Drag Photo or if you prefer...</label>
                        <span class="btn btn-primary" onclick="$('#custom-dropzone').click()">
                            Select Photo from your Computer
                        </span>
                    </div>
                </form -->
                
                <div id="custom-dropzone" class="dropzone">
                    <div id="previews" class="dropzone-previews"></div>
                    <input name="file" type="file" accept="image/*" style="visibility:hidden"/>
                    <div class="dropzone-controls">
                        <label>Drag Photo or if you prefer...</label>
                        <span class="btn btn-primary" id="clickable">
                            Select Photo from your Computer
                        </span>
                    </div>
                </div>
                
                <form id="addInstitutionMediaForm" action="{{ path('institution_mediaGallery_linkFileToClinics') }}" enctype="multipart/form-data" method="post">
                    <input type="hidden" name="media_ids" id="mediaIds">
                    <p><small>Maximum upload file size:</small>2MB</p>

                    {% if not isSingleCenter %}
                        {% include 'InstitutionBundle:MediaGallery/Widgets:medicalCenterList.html.twig' with {selectedClinics: []} %}
                    {% endif %}
                </form>
            </div>
        </div>
    </div>
    {% endblock %}
    
    {% block modalFooter %}
        <div class="align-right action-buttons">
            <button class="btn cancel" onclick="$('#add-media').modal('hide')" type="button">Cancel</button> &nbsp;
            <button class="btn btn-primary save" type="button" disabled="disabled" style="display:{{ isSingleCenter  ? 'none' : '' }}" onclick="$('#addInstitutionMediaForm').submit()"><i class="icon-save"></i>Save Changes</button> &nbsp;
            <button class="btn btn-success done" onclick="$('#add-media').modal('hide'); window.location.reload()" disabled="disabled" type="button">Done</button>
        </div>
    {% endblock %}
    
{% endembed %}

{% block inlineJavascriptCode %}
<script type="text/javascript" src="/js/dropzone.js" ></script>

<script type="text/javascript">
    $(function(){
    
    	Dropzone.autoDiscover = false;
    	var addMediaFormElem = $('#addInstitutionMediaForm');
    	var buttonsContainer = $('#add-media .modal-footer .action-buttons:first'); 
    
        $("#custom-dropzone").dropzone({
            url: "{{ path('institution_mediaGallery_upload') }}",
            method: "post",
            clickable: "#clickable",
            previewsContainer: "#previews",
            
            sending: function(file) {
                addMediaFormElem.find('.action-buttons > button').attr('disabled', 'disabled');
            },

            success: function(file, response) {
                if(response.status) {
                	$(file.previewTemplate).addClass('success');
                	$('#mediaIds').val($('#mediaIds').val() == '' ? response.mediaId : $('#mediaIds').val() + ',' + response.mediaId);
                	addMediaFormElem.find('.medical-center-checkbox:first').change();
                	buttonsContainer.find('button.cancel').remove();
                	buttonsContainer.find('button.done').removeAttr('disabled');
                } else {
                	$(file.previewTemplate).addClass('error');
                }
            }
        });

        addMediaFormElem.find('.medical-center-checkbox').change(function() {
            
            if($('#mediaIds').val() != '' && addMediaFormElem.find('.medical-center-checkbox:checked').length) {
            	buttonsContainer.find('button').removeAttr('disabled');
            } else {
            	buttonsContainer.find('button.save').attr('disabled', 'disabled');
            }
        });
    });
</script>
{% endblock %}