{% extends 'InstitutionBundle::registration.layout.html.twig' %}
{% set disableMainNavigation = true %}
{% set setUpProfile = true %}

{% block content %}

<div class="row">
    <h1>{{ institutionMedicalCenter.name }}</h1>

    <div class="span8">
        {% include 'InstitutionBundle:SignUp/Widgets:modalForm.doctors.html.twig' %}

        <section>
            <div class="row-fluid">
                <h2 class="pull-left">List of Doctors</h2>
                <a href="#add-doctor" class="btn btn-primary btn-large pull-right" data-toggle="modal">Add Doctor</a>
            </div>
        </section>

        <section id="doctorsList" class="doctors-listing" data-loaded="0">
            <h2>
                <small>No doctors on the list, please add your doctors now.</small>
            </h2>
        </section>

        <section id="doneSection" style="display: none">
            <a href="dashboard-hospital-initial.html" class="btn pull-right btn-primary btn-large">
                Done Adding Doctors
            </a>
        </section>
    </div>

    <aside class="span4">
        {# TODO: include steps widget #}
    </aside>
</div>

{% endblock %}


{% block inlineJavascriptCode %}
<script type="text/javascript">
$(window).load(function() {
    $('#add-doctor').modal('show');
});

$('#submitDoctorForm').click(function(){
    var form = $('#doctorForm');

    $.ajax({
        url: "{{ path('institution_signup_setup_doctors', { imcId: institutionMedicalCenter.id }) }}",
        type: 'POST',
        dataType: 'json',
        data: form.serialize(),
        success: function(response){
            var list = $('#doctorsList')
            if (!list.data('loaded')) {
                list.data('loaded', 1);
                list.html('');
            }
            list.append(response.rowDoctor);
            $('#add-doctor').modal('hide');
            $('#doneSection').show();

            var message = $('#confirmation-message');
            message.find('p').html('<b>' + response.doctor.firstName + ' ' + response.doctor.lastName + ' </b> has been added to your Clinic profile');
            message.show();
            setTimeout(function() { message.fadeOut("slow") }, 5000);
        },
        error: function (xhr, ajaxOptions, thrownError) {
            alert(xhr.status);
            alert(thrownError);
        }
    });

    /*
    var resetForm = function(form) {
        form.find('input:text, input:password, input:file, select, textarea').val('');
        form.find('input:radio, input:checkbox').removeAttr('checked').removeAttr('selected');
    }
    resetForm(form);
    */
    form[0].reset();

    return false;
});

$('#doctorsList').on('click', 'ul.actions button[id^="delete-doctor"]', function(e) {
    if (confirm("Delete doctor?")) {
        var doctorId = $(this).data('doctor-id');

        $.ajax({
            url: "{{ path('institution_signup_ajax_deleteDoctor') }}" + "/" + doctorId,
            type: 'POST',
            success: function(response) {
                if (response.success) {
                    $('#rowDoctorContainer' + doctorId).remove();
                    /* TODO: remove done button if there are no doctors left*/
                }

                if (response.message) {
                }
            }
        });
    }
});

$('#doctorsList').on('click', 'ul.actions button[id^="edit-doctor"]', function(e) {
    alert('Unimplemented');
});

</script>
{% endblock %}