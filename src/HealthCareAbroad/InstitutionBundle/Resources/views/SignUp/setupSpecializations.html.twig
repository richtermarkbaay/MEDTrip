{% extends 'InstitutionBundle::registration.layout.html.twig' %}
{% set disableMainNavigation = true %}
{% set setUpProfile = true %}

{% block content %}

<div class="row">
    <h1>{{ institutionMedicalCenter.name | title }}</h1>
    <div class="span8">
        <h2>Add Specializations<br><small>Please select the ones that apply to your Clinic.</small></h2>
        <form name="specializationsForm" action="{{ path('institution_signup_setup_specializations', { imcId: institutionMedicalCenter.id }) }}" method="post">
            {% if error %}
                <div class="alert alert-error">{{ error }}</div>
            {% endif %}
            
            {% include 'InstitutionBundle:MedicalCenter:Partials/accordion.specializations.html.twig' with {specializations : specializations } %}

            <div class="align-right" style="margin-top: 10px;">
                <button type="submit" class="btn pull-right btn-primary btn-large">
                    Save and Continue
                </button>
            </div>
        </form>
    </div>

    <aside class="span4">
    {{ render_signup_steps_by_route(app.request.attributes.get('_route'), isSingleCenter is defined and isSingleCenter) | raw}}
        <section class="aside-box info dashboard-side">
            <p><span><i class="icon-stethoscope icon-4x pull-left"></i></span>
                Indicating all the <b>SPECIALIZATIONS</b> of this clinic will allow you to be searchable by patients looking for specialists or treatments in your areas of expertise.
            </p>
        </section>
    </aside>
</div>
{% endblock %}

{% block inlineJavascriptCode %}

<script type="text/javascript">
$(document).on('show hide', '#accordion', function(e) {
	//$('#accordion').find('.accordion-group > .in.collapse').hide();
    var target = $(e.target);
    target.siblings('.accordion-heading').find('.accordion-toggle i').toggleClass('icon-plus-sign icon-minus-sign');

    var modifiableDiv = target.find('#panel' + target.data('specialization'));

    if (!modifiableDiv.data('loaded')) {
        /* TODO: ideally we should return the data not html */
        $.ajax({
            url: "{{ path('institution_ajax_loadSpecializationComponents') }}",
            type: 'GET',
            data: { 'specializationId': target.data('specialization') },
            dataType: 'html',
            success: function(response){
                modifiableDiv.html(response);
                modifiableDiv.data('loaded', 1);
            }
        });
    }
});


$('form[name="specializationsForm"] input:checkbox[name="subSpecialization"]').live('change', function(e) {
	console.log('subSpecEvent');
    var subSpecializationContainerElem = $(this).parents('.sub-specialization-wrapper:first');
    subSpecializationContainerElem.find('input:checkbox[id^="treatments"]').prop('checked', $(this).is(':checked'));
});

$('form[name="specializationsForm"] input:checkbox[id^="treatments"]').live('change', function(e) {
	console.log('treatmentEvent');
    var subSpecializationContainerElem = $(this).parents('.sub-specialization-wrapper:first');
    var subSpecializationCheckbox = subSpecializationContainerElem.find('input[name=subSpecialization]');
    var checkedTreatmentElems = subSpecializationContainerElem.find('input:checkbox[id^="treatments"]:checked');

    subSpecializationCheckbox.prop('checked', true);
    if(checkedTreatmentElems.length == 0) {
        subSpecializationCheckbox.prop('checked', $(this).is(':checked'));
    }
});

</script>

{% endblock %}