{% set streetAddress = institution_address_to_string(institution, ['address1']) %}
{% set mainAddress = institution_address_to_string(institution, ['city', 'state', 'country', 'zipCode']) %}

{% include 'FrontendBundle:Institution/Widgets:commonHeading.html.twig' with {viewData: {
        headerText: institution.name,
        featuredMediaSource: institution.featuredMedia and institution.featuredMedia.src 
            ? institution.featuredMedia.src 
            : imageplaceholder.institutionFeaturedImage,
        logoSource: institution.logo and institution.logo.src
            ? institution.logo.src
            : null,
        defaultLogoClass: 'clinic-default-logo',
        contactNumber: institution.mainContactNumber,
        streetAddress: streetAddress,
        mainAddress: mainAddress,
        institutionInquiryLink: '#form',
        social: institution.socialMediaSites,
        contactEmail:institution.contactEmail,
        website: institution.websites
    }}
%}

<div class="profile-wrapper span8">
    {{ institution.description | raw }}
    
    {% include 'FrontendBundle:InstitutionMedicalCenter/Widgets:specializations.html.twig' 
        with { institutionSpecializations: institutionMedicalCenter.institutionSpecializations } 
    %}
    
    {% include 'FrontendBundle:Widgets:profileAwardsAndServicesSection.html.twig' with { awards: institutionAwards, services: institutionServices} %}
    
    {% if institutionDoctors|length %}
        {% embed 'FrontendBundle:Embed:profileSection.html.twig' with {title: 'Doctors', class: 'doctors' } %}
            {% block sectionContent %}
                {% include 'FrontendBundle:Widgets:profileDoctorsList.html.twig' with { doctors: institutionDoctors } %}
            {% endblock %}                
        {% endembed %}
    {% endif %}
    
    {% include 'FrontendBundle:Institution/Widgets:commonContactAndAddress.html.twig' 
        with { 
            streetAddress: streetAddress, 
            mainAddress: mainAddress,
            contactNumber: institution.mainContactNumber,
            social: institution.socialMediaSites,
            contactEmail:institution.contactEmail,
            website: institution.websites
        } 
    %}
</div>

<aside class="span4 aside-wrapper">
    {% include 'FrontendBundle:Widgets:profileLocationAside.html.twig' %}

    {% include 'FrontendBundle:Widgets:profileMediaAside.html.twig' with { photos: photos } %}
    
    {% if institutionMedicalCenter.businessHours %}
    <section class="widget-wrapper">
        <h4 class="widget-heading">
            Clinic Schedule
        </h4>
        <ul class="clinic-schedule" id="businessHoursView" >
    		{% if institutionMedicalCenter.isAlwaysOpen != 0 %}
                <li>Open 24/7</li>
    		{% else %}
    		    {% for each in institutionMedicalCenter.businessHours %}
        		   <li>
        		        {% set _bhData =  business_hours_to_view_data(each) %}
                        <span class="fbh_selected_days_label">{{ _bhData.daysLabel | upper }}</span>
                        <b class="fbh_selected_time_label">{{ _bhData.startTime }} - {{ _bhData.endTime }}</b>
                        <p class="fbh_selected_item_notes"> {{ each.notes }} </p>
                    </li>
    			{% endfor %}
    		{% endif %}
        </ul>
    </section>
    {% endif %}
    <section id="form_feedback" class="widget-wrapper">
        <h4 class="widget-heading">
            Email this Clinic
        </h4>
        {% include 'FrontendBundle:Institution/Widgets:inquiryFormAside.html.twig' with {form: form} %}
    </section>
</aside> <!--End of aside_content-->

<div class="span12">
    <p>Copyright 2013, <b>{{ institution.name }}</b> 
    </p>
</div>


{% block inlineJavascriptCode %}
<script type="text/javascript" src="{{asset('bundles/frontend/js/institution.js')}}"></script>
<script type="text/javascript">
<!--
(function($){
    $(function(){
        $('#hospital-contact[rel="tooltip"]').tooltip({
            title: function(){

                var _titleContainer = $('<h5></h5>');
                var _contactDetails = window.JSON.parse($(this).attr('data-contact-number')); 
                $.each(_contactDetails, function(_key, _item){
                    _titleContainer.append('<small>'+_item.type.toUpperCase()+': </small>'+_item.number);
                });
                return _titleContainer;
            },
            html: true,
            delay: 0,
            trigger: 'click',
            animation: false,
            placement: 'top'
        }).click(function(){
            return false;
        });

        $('[rel=popover]').popover({
            placement: 'top',
            html: true,
            trigger: 'click',
            content: function() {
                return $('#_call-content-wrapper').html();
            }
        }).click(function(e) {
            e.preventDefault();
        });
		
        $('#institutionTab a').click(function (e) {
      	  e.preventDefault();
      	  $(this).tab('show');
      	});

        $('#inquiry_submitButton').institutionInquiryModalForm({
            submitButton: $('#inquiry_submitButton'),
            form: $('form#inquiryForm') ,
            path: "{{ path('frontend_institutionMedicaCenter_ajaxSaveImcInquiry', {institutionId : institution.id, imcId: institutionMedicalCenter.id}) }}"
        });
    });
})(jQuery);
//-->
</script>
{% endblock %}

