{% extends 'FrontendBundle::layout.html.twig' %}

{% set email = institutionMedicalCenter.contactEmail ? institutionMedicalCenter.contactEmail : institution.contactEmail %}
{% set number = render_institution_medical_center_contact_number(institutionMedicalCenter)  %}
{% set websites = institutionMedicalCenter.websites ? institutionMedicalCenter.websites : institution.websites %}
{% set websites = json_decode(websites) %}
{% set mainWebsites = (websites.main is defined) and websites.main ? websites.main : false %}


{% block callout %}
    {% embed 'FrontendBundle:Embed:callout.base.html.twig' %}
        {% block calloutContent %}
            <a href="{{ get_institution_frontend_url(institution) }}" class="mini-logo-wrapper">
                {{ render_institution_logo(institution, {attr: {class: 'mini', alt: 'logo'}}) | raw }}
            </a>
            <h2 class="heading"><a href="{{ get_institution_frontend_url(institution) }}">{{ institution.name }}</a></h2>
            <a class="btn green" href="{{ get_institution_frontend_url(institution) }}"><span class="hca-sprite list-icon"></span> Hospital Page</a>
        {% endblock %}
    {% endembed %}
{% endblock %}

{% block content %}

    <!-- Set map coordinates by LatLong or Address -->
    {% if institutionMedicalCenter.coordinates %}
        {% set coordinates = institutionMedicalCenter.coordinates %}
    {% else %}
        {% set coordinates = medical_center_complete_address_to_string(institutionMedicalCenter, ['address', 'city', 'country', 'zipCode']) %}
    {% endif %}

        <div class="span8 profile-wrapper">

            {% include 'FrontendBundle:InstitutionMedicalCenter/Widgets:heading.html.twig' %}
            
            <p>{{ institutionMedicalCenter.description | raw }}</p>

            {% include 'FrontendBundle:InstitutionMedicalCenter/Widgets:specializations.html.twig' 
                with { specializations: institutionMedicalCenter.institutionSpecializations } %}

            {% include 'FrontendBundle:Widgets:profileAwardsAndServicesSection.html.twig' %}

            {% if institutionMedicalCenter.doctors|length %}
                {% embed 'FrontendBundle:Embed:profileSection.html.twig' with {title: 'Doctors', class: 'doctors' } %}
                    {% block sectionContent %}
                        {% include 'FrontendBundle:Widgets:profileDoctorsList.html.twig' with { doctors: institutionMedicalCenter.doctors } %}
                    {% endblock %}                
                {% endembed %}
            {% endif %}

        </div> <!--End of main_content-->

        <aside class="span4 aside-wrapper">

            {% include 'FrontendBundle:Widgets:profileLocationAside.html.twig' %}

            {% include 'FrontendBundle:InstitutionMedicalCenter/Widgets:scheduleAside.html.twig' 
                with { businessHours: institutionMedicalCenter.businessHours } %}

            {% include 'FrontendBundle:Widgets:profileMediaAside.html.twig' 
                with { media: institutionMedicalCenter.media, institution: institutionMedicalCenter.institution, logo: institutionMedicalCenter.logo } %}

            {% include 'FrontendBundle:Widgets:profileSocialAside.html.twig' with { urls: websites } %}

        </aside> <!--End of aside_content-->
     
{% endblock %}

{% block inlineJavascriptCode %}
<script src="{{ asset('bundles/frontend/js/institution.js') }}"></script>
<script type="text/javascript">
<!--
(function($){
    $(function(){

        $('#modal_imc_inquiry_form').institutionInquiryModalForm({
            submitButton: $('#modal_imc_inquiry_submitButton'),
            form: $('form#{{ formId }}') 
        });
        
        $('#clinicCallUs').tooltip({
            title: function(){
                var _titleContainer = $('<h5></h5>');
                var _contactDetails = window.JSON.parse($(this).attr('data-contact-number')); 
                $.each(_contactDetails, function(_key, _item){
                    _titleContainer.append('<small>'+_item.type.toUpperCase()+': </small>'+_item.number);
                });
                return _titleContainer;
            },
            html: true,
            delay: 0,
            trigger: 'click',
            animation: false,
            placement: 'top'
        })
        .click(function(){
            return false;
        });
    });
})(jQuery);
//-->
</script>
{% endblock %}