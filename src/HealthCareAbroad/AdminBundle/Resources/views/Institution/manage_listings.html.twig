{% extends 'AdminBundle::layout.html.twig' %}

{% block content %}
	<div id="content">

		<div id="page-heading"><h3>List of Listings</h3></div>

		{% embed '::contentWrapper.admin.html.twig' %}
			{% block wrappedContent %}

			{% include '::notice.admin.html.twig' %}

			<div id="filter-wrapper">
				<label>Filter by Center: </label>
				<select id="procedure_filter" class="styledselect_form_1">
					<option>Center1</option>
				</select>
			</div>
			
			<div id="institution-listings" style="width:70%">

			{% for procedureType in medicalProcedureTypes %}	 
				<h3><a href="#">{{ procedureType.medicalProcedureType.name }}</a></h3>
				<div class="procedures">
					<a class="add-procedure" href="{{ path('admin_institution_addMedicalProcedure', {id:id, institution_medical_procedure_type_id: procedureType.id }) }}" style="float: right;margin-right: 20px;color: #92B22C;text-decoration:underline">add procedure</a>
					{% if procedureType.institutionMedicalProcedures|length %}
						<ul style="list-style:none;margin:40px 20px;border-top: 1px solid #ddd;border-left: 1px solid #ddd; border-right: 1px solid #ddd">
							{% set procedures = procedureType.institutionMedicalProcedures %}
							{% for procedure in procedures %}
							{% set medicalProcedure = procedure.medicalProcedure %}
								<li style="padding: 5px;border-bottom: 1px solid #ddd">
									<p style="display: inline-block;">{{ medicalProcedure.name }}</p>  
									<div style="display:inline-block;float:right;margin-right:20px">
										<a href="#">activate</a>
										<span class="bar">|</span>
										<a href="{{ path('admin_institution_editMedicalProcedure', {id:id, institution_medical_procedure_type_id:procedureType.id, medical_procedure_id:medicalProcedure.id} ) }}">edit</a>
									</div>
								</li>
							{% endfor %}
						</ul>
					{% endif %}
				</div>
			{% else  %}
				<div class="empty-list" colspan="4">No records yet!</div>
			{% endfor %}
			</div>

			{% endblock %}
		{% endembed %}
	</div>

	<div id="dialog-container">
		
	</div>

{% endblock %}

{% block inlineJavascriptCode %}
	<script src="{{ asset('bundles/institution/js/InstitutionMedicalProcedure.js') }}"></script>
	<script type="text/javascript">
		$(function(){

			$("#dialog-container").dialog({
				autoOpen: false,
				height: 580,
				width: 700,
				modal: true,
				resizable: false,
				//buttons: {"Save": function() {var bValid = true;}, Cancel: function() {$( this ).dialog( "close" );} },
				close: function() {}
			});

			$("a.add-procedure").click(function() {
				var elem = $(this);
				var addProcedureUrl = elem.attr('href');
				elem.attr('href', 'javascript:void(0)');

				$("#dialog-container").empty();
				$("#dialog-container").dialog({
					open: function() {
						$.ajax(addProcedureUrl)
							.done(function (data) {
								elem.attr('href', addProcedureUrl);
								$('#dialog-container').html(data);
							});
					},
				});
				$("#dialog-container").dialog("open");
			});

			$("#institution-listings").accordion();			
		});
	</script>
{% endblock %}
