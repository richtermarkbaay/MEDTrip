{% extends 'AdminBundle::layout.html.twig' %}
{% set selectedTab = 'institutions'%}
{% block content %}
	<div id="content">

		<div id="page-heading"><h3>{{ institution.name }} Procedure Types for {{ institutionMedicalCenter.medicalCenter.name }} center</h3></div>

		{% embed '::contentWrapper.admin.html.twig' %}
			{% block wrappedContent %}

			{% include '::notice.admin.html.twig' %}


			{% include '::relatedTasks.base.admin.html.twig' with 
				{'contents': [
					{
						'title': 'Add new procedure type', 
						'description': 'Create a new procedure type',
						'class' : 'add-icon',
						'href': path('admin_institution_procedureType_add', {institutionId:institution.id, imcId:institutionMedicalCenter.id}), 
						'links': [{
							'title' : 'Add procedure type',
							'href': path('admin_institution_procedureType_add', {institutionId:institution.id, imcId:institutionMedicalCenter.id}), 
						}]
					}
    			]} 
			%}

			<!-- Render Filter Box -->
			{% autoescape false %} {{ listFilters is defined ? listFilters : '' }} {% endautoescape %}	

			{% if not medicalProcedureTypes|length %}
				<div class="empty-list">No records yet!</div>
			{% endif %}
			<div id="institution-procedure-types" style="width:70%">

			{% for procedureType in medicalProcedureTypes %}	 
				<h3>
					<a href="#">{{ procedureType.medicalProcedureType.name }}</a>
					<span style="float: right; color: #888">{{ procedureType.status ? 'active' : 'inactive' }}</span>
				</h3>
				<div class="procedures">
					<p style="color: #aaa">{{ procedureType.description }}</p>

					<a href="{{ path('admin_institution_medicalProcedure_add', {institutionId:institution.id, imcId:institutionMedicalCenter.id, imptId:procedureType.id }) }}" class="add-procedure button-type" >Add Procedure</a>
					<a href="{{ path('admin_institution_procedureType_edit', {institutionId:institution.id, imcId:institutionMedicalCenter.id, imptId:procedureType.id }) }}" class="button-type">Edit</a>


				    <table width="100%" class="generic-table" id="medical-centers-list">
	    				<tr>
	    					<th width="200"><a href="#">Procedures</a></th>
	    					<th><a href="#">Description</a></th>
	    					<th class="actions" width="100"><a href="#">Options</a></th>
	    				</tr>

						{% set procedures = procedureType.institutionMedicalProcedures %}

						{% for procedure in procedures %}
							{% set medicalProcedure = procedure.medicalProcedure %}
							<tr>
								<td>{{ medicalProcedure.name }}</td>
								<td>{{ procedure.description }}</td>  
								<td>
	            					<a href="{{path('admin_institution_medicalProcedure_edit', {institutionId: institution.id, imcId: institutionMedicalCenter.id, imptId: procedureType.id, impId: procedure.id})}}" title="Edit" class="edit-procedure icon-1 info-tooltip"></a>
	            					{% set class = medicalProcedure.status ? 'icon-2' : 'icon-5' %}
	            					<a href="{{ path('admin_institution_medicalProcedure_updateStatus', {impId:procedure.id}) }}"
	            						title="{{ medicalProcedure.status ? 'Delete' : 'Activate' }}" 
	            						class="update-status {{ class }} info-tooltip">
	            					</a>
								</td>
							</tr>
						{% else  %}
							<tr><td colspan="3" class="empty-list">No Medical Procedures yet!</td></tr>
						{% endfor %}
					</table>

				</div>
			{% endfor %}
			</div>

			{% endblock %}
		{% endembed %}
	</div>

{% endblock %}

{% block inlineJavascriptCode %}
	<script src="{{ asset('bundles/institution/js/InstitutionMedicalProcedure.js') }}"></script>
	<script type="text/javascript">
		$(function(){

			$("#dialog-container").dialog({
				autoOpen: false,
				width: 700,
				modal: true,
				resizable: false,
				close: function() {}
			});

			$("a.add-procedure, a.edit-procedure").click(function() {
				var elem = $(this);
				var addProcedureUrl = elem.attr('href');
				elem.attr('href', 'javascript:void(0)');

				$("#dialog-container").empty();
				$("#dialog-container").dialog({
					title: (elem.hasClass('edit-procedure') ? 'Edit' : 'Add') + ' Medical Procedure',
					open: function() {
						$.ajax(addProcedureUrl)
							.done(function (data) {
								elem.attr('href', addProcedureUrl);
								$('#dialog-container').html(data);
							});
					},
				});
				$("#dialog-container").dialog("open");
			});

			{% if medicalProcedureTypes is not empty %} 
			$("#institution-procedure-types").accordion();
			{% endif %}
		});
	</script>
{% endblock %}