{% extends 'AdminBundle::layout.html.twig' %}
{% set selectedTab = 'institutions'%}
{% block content %}

	<div id="content">

		<div id="page-heading"><h3>{{ institutionName }} Medical Centers</h3></div>

		{% embed '::contentWrapper.admin.html.twig' %}

			{% block wrappedContent %}

				{% include '::notice.admin.html.twig' %}
			
				{% include '::relatedTasks.base.admin.html.twig' with 
					{'contents': [
						{
							'title': 'Add medical center', 
							'description': 'Add new medical center to this institution',
							'class': 'add-icon add-medical-center',
							'href': path('admin_institution_medicalCenter_add', {institutionId:institutionId}), 
							'links': [{
								'title': 'click here to add',
								'class': 'add-medical-center',
								'href': path('admin_institution_medicalCenter_add', {institutionId:institutionId})
							}]
						}
	    			]} 
				%}

				<!-- Render Filter Box -->
				{% autoescape false %} {{ listFilters is defined ? listFilters : '' }} {% endautoescape %}	
				
			    <table width="70%" class="generic-table" id="medical-centers-list">
    				<tr>
    					<th width="300"><a href="#">Medical Centers</a></th>
    					<th width="400"><a href="#">Description</a></th>
    					<th width="100"><a href="#">Status</a></th>
    					<th width="80"><a href="#">Options</a></th>
    				</tr>

    				{% for center in institutionMedicalCenters %}
    				    <tr id="medical-center-{{center.id}}">
        					<td class="name">{{ center.medicalCenter | title }}</td>
        					<td>{{ center.description }}</td>
        					<td class="status">{{ centerStatusList[center.status] }}</td>
        					<td class="options-width">
            					<a href="{{ path('admin_institution_medicalCenter_edit', {institutionId:institutionId, imcId:center.id}) }}" title="Edit" class="icon-1 info-tooltip edit-medical-center"></a>
            					<a id="status-{{ center.id }}" href="{{ path('admin_institution_medicalCenter_updateStatus', {imcId:center.id}) }}" class="show-update-status icon-type">change status</a>
        					</td>
        				</tr>
        			{% else %}
    				    <tr>
    				        <td colspan="4" class="empty-list"> {{ app.session.get('institutionName') }} has no medical centers yet. </td>
    				    </tr>
    				{% endfor %}
				</table>

			{% endblock %}
		{% endembed %}
	</div>
	
	<div id="update-status-container" title="Edit Institution Center Status">
		<p>
			<strong id="current-institution-center"></strong> is currently <strong id="current-status"></strong>. 
			Select an option below to update its status.
		</p>
		<select id="selected-status">
			{% for label,value in updateCenterStatusOptions %}
				<option value="{{value}}">{{label}}</option>
			{% endfor %}
		</select>
		<a id="update-status-button" href="#" class="button-type">Confirm</a>
	</div>

{% endblock %}

{% block inlineJavascriptCode %}
<script type="text/javascript">
	$(function(){

		$("#update-status-container").dialog({autoOpen:false, height:250, width:400, modal:true, resizable:false, close:function(){}});

		$("a.show-update-status").click(function() {

			var url = $(this).attr('href');

			var institutionMedicalCenterId = $(this).attr('id').split('-').pop();

			var currentStatus = $('#medical-center-'+institutionMedicalCenterId+' > td.status').html();
			var institutionMedicalCenterName = $('#medical-center-'+institutionMedicalCenterId+' > td.name').html();

			$('#current-status').html(currentStatus);
			$('#current-institution-center').html(institutionMedicalCenterName);

			$('#update-status-button').attr('href', url + '/' + $('#selected-status').val());
			$('#selected-status').change(function(){
				$('#update-status-button').attr('href', url + '/' + $(this).val());
			});
			
			$("#update-status-container").dialog("open");
			return false;
		});
	});
</script>
{% endblock %}