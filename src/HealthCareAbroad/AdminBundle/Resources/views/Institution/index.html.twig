{% extends 'AdminBundle::layout.html.twig' %}
{% set selectedTab = 'institutions'%}
{% set selectedSubTab = 'institutions_index'%}

{% block content %}
    <div id="content">

        <div id="page-heading"><h3>List of Institutions</h3></div>

        {% embed '::contentWrapper.admin.html.twig' %}
            {% block wrappedContent %}
            
            {% include '::notice.admin.html.twig' %}

            <!-- Render Filter Box -->
            {% autoescape false %} {{ listFilters is defined ? listFilters : '' }} {% endautoescape %}

            {% set sortBy = app.request.get('sortBy') %}
            {% set sortOrder = app.request.get('sortOrder') %}
            {% set default = sortBy | length ? '' : 'sort-asc' %}
            
            <div>
                <table class="table table-bordered">
                <tr>
                    <th id="column-name"><a href="{{ app.request.uri }}" class="{{ sortBy == 'name' ? 'sort-' ~ sortOrder : default }}">Name</a></th>
                    <th width="500" id="column-description"><a href="{{ app.request.uri }}" class="{{ sortBy == 'description' ? 'sort-' ~ sortOrder : '' }}">Description</a></th>
                    <th><a href="#">Status</a></th>
                    <th class="actions">Actions</th>
                </tr>

                {% for institution in institutions %}
                    <tr id="institution-{{institution.id}}">
                        <td><a class="name" href="{{ path('admin_institution_view', {institutionId: institution.id}) }}" title="View {{ institution.name }}">{{ institution.name }}</a> </td>
                        <td><a href="{{ path('admin_institution_view', {institutionId: institution.id}) }}" title="View {{ institution.name }}">{{ institution.description }}</a></td>
                        <td class="status">{{ statusList[institution.status] }}</td>
                        <td align="center">
                            <a href="{{ path('admin_institution_manageCenters', {institutionId:institution.id}) }}" class="icon-type">centers</a> 
                            <a id="status-{{institution.id}}" href="{{ path('admin_institution_updateStatus', {institutionId:institution.id}) }}" class="show-update-status icon-type">
                                change status
                            </a>
                    </tr>
                {% else  %}
                    <tr><td class="empty-list" colspan="4">No records yet!</td></tr>
                {% endfor %}
                </table>

                {% if pager.isPaginable %}
                    {{ paginate(pager, 'admin_institution_index', app.request.query.all) }}
                {% endif %}
            </div>
            
            {% endblock %}
        {% endembed %}
    </div>

    <div id="update-status-container" title="Edit Institution Status">
        <p>
            <strong id="current-institution"></strong> is currently <strong id="current-status"></strong>. 
            Select an option below to update its status.
        </p>
        <form id="update-status-form" method="POST">
        <select name="status" id="selected-status">
            {% for label,value in updateStatusOptions %}
                <option value="{{value}}">{{label}}</option>
            {% endfor %}
        </select>
        <input type="submit" class="green-button" value="Confirm"/>
        </form>

    </div>
    
{% endblock %}

{% block inlineJavascriptCode %}
<script type="text/javascript">
    $(function(){

        $("#update-status-container").dialog({autoOpen:false, height:250, width:400, modal:true, resizable:false, close:function(){}});

        $("a.show-update-status").click(function() {

            var url = $(this).attr('href');
            var institutionId = $(this).attr('id').split('-').pop();
            var currentStatus = $('#institution-'+institutionId+' > td.status').html();
            var institutionName = $('#institution-'+institutionId+' td > a.name').html();

            $('#current-status').html(currentStatus);
            $('#current-institution').html(institutionName);

            $('#update-status-form').attr('action', url);
            
            $("#update-status-container").dialog("open");
            return false;
        });
    });
</script>
{% endblock %}