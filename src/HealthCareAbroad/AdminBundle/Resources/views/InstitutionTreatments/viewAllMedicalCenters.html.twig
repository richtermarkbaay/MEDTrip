
{% extends 'AdminBundle::layout.institution.html.twig' %}
{% set selectedTab = 'institutions'%}

{% block content %}
    <div id="content" class="span9">
                {% include '::notice.admin.html.twig' %}

{#
                <!-- Render Filter Box -->
                {% autoescape false %} {{ listFilters is defined ? listFilters : '' }} {% endautoescape %}    
                {% set sortBy = app.request.get('sortBy') %}
                {% set sortOrder = app.request.get('sortOrder') %}
                {% set default = sortBy | length ? '' : 'sort-asc' %}
#}

{% set centerLabel = getClassLabel('institution_medical_center') | title %}

{% embed 'HelperBundle:Widgets:section.html.twig' 
    with { 
        title: 'Medical Centers',
        actions: [{link: path('admin_institution_medicalCenter_add', {institutionId:institution.id}), label: 'Add Medical Center', 'icon' : 'icon-ok' }] 
    }  
%}

    {% block sectionContent %}

        <div id="centersAccordion">

            {% for center in institutionMedicalCenters %}
                <h5 class="medical-centers" style="border: 1px solid #eee; margin-top: 10px;padding: 10px">
                    <a href="{{ path('admin_institution_medicalCenter_update', {imcId: center.id, institutionId: institution.id}) }}" class="pull-right edit-center-name" style="font-size:13px;font-weight:normal;">
                        <i class="icon-edit"></i> <span>edit</span>
                    </a>
                    <a class="url" href="{{ path('admin_institution_centerSpecializations', {imcId: center.id, institutionId: institution.id}) }}">{{ center }}</a>
                    <input type="text" value="{{ center.name }}" style="margin:0;display:none" onclick="return false"/>
                </h5>
                <div class="content" style="background: #efefef;padding: 10px">
                    <div style="border: 1px dashed #ddd;margin-bottom: 20px;padding: 5px 10px;">
                        <a href="{{ path('admin_institution_medicalCenter_update', {imcId: center.id, institutionId: institution.id}) }}" class="pull-right edit-center-description" style="font-size:13px;font-weight:normal">
                            <i class="icon-edit"></i> <span>edit</span>
                        </a>
                        <div class="center-description">{{ center.description | raw }}</div>
                        <textarea required="required" class="tinymce edit-center-textarea" style="display:none">{{ center.description }}</textarea>
                    </div>
                    <div class="specializations"></div>
                </div>
{#
                <tr id="medical-center-{{center.id}}">
                    <td class="name">{{ center.name | title }}</td>
                    <td class="specializations">
                        <ul>
                            {% for each in center.institutionSpecializations %}
                                <li style="margin-left: 20px">{{ each.specialization.name | title }}</li>
                            {% endfor %}
                        </ul>
                    </td>
                    <td class="raw-content">{{ center.description|raw }}</td>
                    <td class="status">{{ centerStatusList[center.status] }}</td>
                    <td class="options-width">
                        <a href="{{ path('admin_institution_medicalCenter_edit', {institutionId:institutionId, imcId:center.id}) }}" title="Edit" class="edit-medical-center">
                            <i class="icon-edit"></i> <span>Edit</span>
                        </a>
                        <br/>
                        <a id="status-{{ center.id }}" href="{{ path('admin_institution_medicalCenter_updateStatus', {institutionId:institutionId,imcId:center.id}) }}" class="show-update-status">
                            <i class="icon-edit"></i> Edit status
                        </a>
                    </td>
                </tr>
#}
            {% else %}
                <div> {{ app.session.get('institutionName') }} has no medical centers yet. </div>
            {% endfor %}
        </div>
{#
        {% if pager.isPaginable %}
            {{ paginate(pager, 'admin_institution_manageCenters', app.request.query.all | merge(app.request.get('_route_params')) ) }}
        {% endif %}                
#}

    </div>
    {% endblock %}
{% endembed %}
    <!-- 
    <div id="update-status-container" title="Edit Institution Center Status">
        <p>
            <strong id="current-institution-center"></strong> is currently <strong id="current-status"></strong>. 
            Select an option below to update its status.
        </p>
        <form id="update-status-form" method="POST">
            <select name="status" id="selected-status">
                {% for label,value in updateCenterStatusOptions %}
                    <option value="{{value}}">{{label}}</option>
                {% endfor %}
            </select>
            <input type="submit" class="green-button" value="Confirm"/>
        </form>
    </div>
     -->

{% endblock %}


{% block inlineJavascriptCode %}
<script type="text/javascript">
    $(function(){
        $('#centersAccordion').accordion({active: false, collapsible: true, heightStyle: "content"});

        $('.medical-centers').click(function(){
            var url = $(this).find('.url').attr('href');
            var specializationElem = $(this).next().find('.specializations:first');

            if($.trim(specializationElem.html()) == '') {
            	specializationElem.html('<div class="ajax-loading">loading...</div>');
                $.get(url, function(result) {
                	specializationElem.html(result);
                });
            }
        });

        $('.edit-center-description').click(function(){
            if($(this).next().is(':visible')) {
            	$(this).find('i').attr('class', 'icon-ok');
            	$(this).find('span').html('save')
                $(this).next().hide().siblings('.mceEditor').show();

            } else {
                var url = $(this).attr('href');
                var param = { description: $(this).siblings('textarea').val() };

            	$.post(url, param, function(result){}, 'json');

            	$(this).find('i').attr('class', 'icon-edit');
            	$(this).find('span').html('edit')
                $(this).next().html(param.description).show().siblings('.mceEditor').hide();                
            }

            return false;
        });

        $('.edit-center-name').click(function(){
            if($(this).next().is(':visible')) {
            	$(this).find('i').attr('class', 'icon-ok');
            	$(this).find('span').html('save')
                $(this).next().hide().siblings('input').show();
        
            } else {
                var url = $(this).attr('href');
                var param = { name: $(this).siblings('input').val() };

            	$.post(url, param, function(result){}, 'json');

            	$(this).find('i').attr('class', 'icon-edit');
            	$(this).find('span').html('edit')
                $(this).next().html(param.name).show().siblings('input').hide();

            	$("#centersAccordion").accordion("enable");
            }

            return false;
        }).siblings('input').click(function(){$('#centersAccordion').accordion("disable"); });


        /*$("#update-status-container").dialog({autoOpen:false, height:250, width:400, modal:true, resizable:false, close:function(){}});

        $("a.show-update-status").click(function() {

            var url = $(this).attr('href');
            var institutionMedicalCenterId = $(this).attr('id').split('-').pop();
            var currentStatus = $('#medical-center-'+institutionMedicalCenterId+' > td.status').html();
            var institutionMedicalCenterName = $('#medical-center-'+institutionMedicalCenterId+' > td.name').html();

            $('#current-status').html(currentStatus);
            $('#current-institution-center').html(institutionMedicalCenterName);
            $('#update-status-form').attr('action', url);

            $("#update-status-container").dialog("open");

            return false;
        });
        */
    });

    function test()
    {
        alert('bert');
        }
</script>
{% endblock %}