{% extends 'AdminBundle::layout.institution.html.twig' %}
{% set centerLabel = getClassLabel('institution_medical_center').singular | title %}

{% block title %}{{ parent() }} Add {{ centerLabel }} {% endblock %}


{% block content %}
    <div class="span9">

        <form novalidate="novalidate" method="POST" class="basic-form" >
            {{ form_errors(form) }}
            {{ form_row(form.firstName) }}
            <a id="addDoctors" href="{{ path('admin_institution_medicalCenter_addNewMedicalSpecialist', {institutionId: institution.id,imcId: institutionMedicalCenter.id } )}}" class="btn btn-mini pull-right">
                <i class="icon-plus"></i>Add New Doctors
            </a>
            {{ form_row(form.id) }}
            {{ form_rest(form) }}
            <br><br>
            <div style="margin-top:15px;">
                <table id="medicalSpecialistTable" class="table table-striped table-bordered">
					<tr>
						<th>Medical Specialist</th>
						<th>Actions</th>
					</tr>
    			</table>
			</div>
                
                <!-- TODO: this sidebar should not be part of the form. Let the ui-team fix this -->
                <div class="span3">
                    {# include 'InstitutionBundle:Widgets:sidebar.benefitsShowcase.html.twig' #}
                </div>
                
                <div class="clearfix"></div>
                <input type="submit" name="submit" value="Submit" class="button-next btn-medium btn btn-info" />
        </form>
    </div>
{% endblock %}

{% block inlineJavascriptCode %}
    <script src="{{ asset('bundles/helper/js/DoctorAutocomplete.js') }}"></script>
	<script type="text/javascript">

		$(function() {
			$('#centersAccordion').accordion({active: false, collapsible: true, heightStyle: "content"});

			$('#dialog-container').dialog({
	            position: ['center', 100],
	            autoOpen: false,
	            width: 750,
	            modal: true,
	            resizable: false,
	            close: function() {}
	        });

			$('#addDoctors').click(function(){
	        	var elem = $(this);
				var _url = elem.attr('href');
			    console.log(_url);
				$("#dialog-container").empty();
				//$('#dialog-container').dialog('option','title', (elem.hasClass("edit") ? 'Edit' : 'Add') + ' GlobalAwards');
	            $('#dialog-container').dialog({
	            	title: 'Add New Doctor',
	                open: function() {
	                    $.ajax(_url)
	                        .done(function (data) {        
	                        	$('#dialog-container').html(data);
	                        }
	                    );
	                },
	            });

	        	$('#dialog-container').dialog("open");

	             	return false;           
	        });
			var availableDoctors = $.parseJSON('{{ doctorsJSON | raw}}');
			var inputHiddenField = "#institutionDoctorSearch_id";
			var inputAutoDoctor = "#institutionDoctorSearch_firstName";
			var selectedTags = [];
		    
        	var params = {
                	availableTags: availableDoctors,
                	selectedTags : selectedTags,
                	inputHiddenField :inputHiddenField,
                	inputAutoDoctor :inputAutoDoctor
        		};
        	DoctorAuto.init(params);
		});

		</script>	
{% endblock %}